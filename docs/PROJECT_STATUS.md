# Symancy: Статус проекта и план завершения

**Дата:** 17 февраля 2026
**Контракт:** TZ_EXTENDED_MVP (2 275 000 руб.)
**Дедлайн по контракту:** 9 февраля 2026 (просрочен)
**Текущая версия:** v0.6.16

---

## 1. Сводка по контракту

### 1.1. Бюджет и оплаты

| Этап | Сумма | Статус |
|------|-------|--------|
| Pre-MVP (часть 1) | 227 500 руб. | Оплачено |
| Pre-MVP (часть 2) | 227 500 руб. | Оплачено |
| Alpha | 682 500 руб. | Оплачено |
| Beta | 682 500 руб. | Оплачено |
| Финальный | 455 000 руб. | Оплачено |
| **ИТОГО** | **2 275 000 руб.** | **100% оплачено** |

### 1.2. Изменения относительно ТЗ

| Пункт ТЗ | Было | Стало | Причина |
|-----------|------|-------|---------|
| Платежная система #1 | СБП через Тинькофф | YooKassa (включая СБП) | Упрощение, YooKassa поддерживает СБП |
| Платежная система #2 | CloudPayments | YooKassa для Telegram | Единый провайдер, проще поддержка |
| Платежная система #3 | Telegram Stars | Telegram Stars | Без изменений |
| Модель монетизации | Подписки (FREE/BASIC/ADVANCED/PREMIUM) | Кредитная система (pay-per-use) | Решение заказчика, документ согласования |
| Мониторинг | Grafana + Prometheus + Posthog | Базовый (Uptime + алерты + логи) | Согласовано с заказчиком |
| Тестирование | >70% coverage + E2E + нагрузочные | Средний уровень: критические потоки + основные user stories | Согласовано с заказчиком |

---

## 2. Статус реализации по блокам

### БЛОК 1: Core Functions (139 ч | 417 000 руб.) — 90% готово

| Функция | Часы по ТЗ | Статус | Примечания |
|---------|-----------|--------|------------|
| Регистрация пользователей | 12 ч | DONE | Onboarding через Telegram Bot, сбор данных |
| Прием и валидация фото | 15 ч | DONE | JPEG/PNG, client-side сжатие до WebP |
| Базовый AI анализ фото | 20 ч | DONE | OpenRouter Vision API, множество моделей |
| Генерация ответа | 18 ч | DONE | HTML форматирование, chunking, персонализация |
| Текстовый ввод символов | 10 ч | DONE | Парсинг описаний, отдельный промпт |
| Простая БД сессий | 15 ч | DONE | Supabase PostgreSQL, CRUD |
| Проверка тарифа | 8 ч | DONE | Кредитная система вместо подписок |
| Счетчики использования | 10 ч | DONE | Атомарное списание кредитов |
| Блокировка при превышении | 6 ч | DONE | Проверка баланса перед анализом |
| Telegram Stars базовая | 15 ч | NOT DONE | Не реализовано |
| Активация подписки | 10 ч | PARTIAL | Кредиты начисляются после оплаты через YooKassa |

**Итого по блоку:** 124/139 часов реализовано

### БЛОК 2: Essential Functions (219 ч | 657 000 руб.) — 65% готово

| Функция | Часы по ТЗ | Статус | Примечания |
|---------|-----------|--------|------------|
| Typing индикаторы | 4 ч | DONE | `chat_action=typing`, задержки |
| Вариативные ответы | 8 ч | DONE | Рандомизация приветствий, персональные детали |
| Обработка ошибок | 10 ч | DONE | Graceful degradation, fallback модели, retry |
| Inline кнопки меню | 6 ч | DONE | Reply/Inline keyboards, topic selection |
| Multi-language | 12 ч | DONE | i18n: RU, EN, ZH — 3 языка |
| Trial период | 15 ч | NOT DONE | 7 дней бесплатного расширенного доступа |
| Автопродление | 18 ч | NOT DONE | Не применимо к кредитной модели (нет подписок) |
| Управление подпиской | 12 ч | PARTIAL | Просмотр баланса есть, управление подпиской — нет (нет подписок) |
| Множественные платежки | 25 ч | PARTIAL | YooKassa (web) работает. YooKassa (Telegram) и Telegram Stars — не сделано |
| Авторизация через Telegram | 10 ч | DONE | Telegram Login Widget + Custom JWT + Supabase Auth |
| Профиль пользователя | 12 ч | DONE | Просмотр/редактирование в Mini App |
| История анализов | 15 ч | DONE | Список с пагинацией в Mini App |
| Управление подпиской UI | 14 ч | PARTIAL | Покупка кредитов через YooKassa. Полноценное управление — нет |
| Responsive дизайн | 8 ч | DONE | Mobile-first, Telegram Mini App |
| Хранение диалогов | 20 ч | DONE | PostgreSQL, embeddings (BGE), memory service |
| Учет предыдущих гаданий | 15 ч | DONE | Контекст в промптах, персонализация |
| Персонализация по истории | 25 ч | PARTIAL | Базовая персонализация есть, ML рекомендации — нет |

**Итого по блоку:** ~143/219 часов реализовано

### БЛОК 3: Advanced Functions (110 ч | 330 000 руб.) — 20% готово

| Функция | Часы по ТЗ | Статус | Примечания |
|---------|-----------|--------|------------|
| Векторная БД паттернов | 15 ч | PARTIAL | Embeddings есть (BGE client), паттерны не наполнены |
| Обучение на истории | 20 ч | NOT DONE | Embeddings pipeline не запущен |
| Similarity search | 12 ч | NOT DONE | Memory service есть, search по паттернам — нет |
| Feedback loop | 18 ч | NOT DONE | Нет сбора оценок и дообучения |
| UI ввода настроения | 15 ч | NOT DONE | Дневник настроения не реализован |
| Корреляция с гаданиями | 12 ч | NOT DONE | Аналитика связей не реализована |
| Графики и визуализация | 10 ч | NOT DONE | Charts не реализованы |
| Агрегация за день | 12 ч | PARTIAL | Engagement triggers (daily/weekly) есть |
| AI суммаризация | 15 ч | NOT DONE | Дневной отчёт не реализован |
| Рекомендации на завтра | 10 ч | NOT DONE | Персональные советы не реализованы |

**Итого по блоку:** ~22/110 часов реализовано

### БЛОК 4: Инфраструктура (248 ч | 744 000 руб.) — 45% готово

#### 4.1. Платежные системы (75 ч)

| Система | Часы по ТЗ | Статус | Примечания |
|---------|-----------|--------|------------|
| YooKassa (Web) | 30 ч | DONE | Оплата через виджет, фискальные чеки 54-ФЗ |
| YooKassa (Telegram Bot) | 28 ч | NOT DONE | Оплата внутри бота через YooKassa |
| Telegram Stars | 17 ч | NOT DONE | Нативные платежи через Telegram Stars |

#### 4.2. DevOps Production-ready (60 ч)

| Функция | Часы по ТЗ | Статус | Примечания |
|---------|-----------|--------|------------|
| CI/CD pipeline | 20 ч | DONE | GitHub Actions, atomic symlink deploy, Telegram notifications |
| Docker контейнеры | 15 ч | PARTIAL | Нет Docker (Supabase Edge Functions + VPS direct deploy) |
| Мониторинг | 15 ч | PARTIAL | Deploy notifications в Telegram. Grafana/Prometheus — нет |
| Backup стратегия | 10 ч | PARTIAL | Supabase managed backups. Disaster recovery — не настроен |

#### 4.3. Безопасность и Compliance (60 ч)

| Функция | Часы по ТЗ | Статус | Примечания |
|---------|-----------|--------|------------|
| Rate limiting | 15 ч | DONE | Реализовано в backend (router module) |
| Шифрование данных | 15 ч | PARTIAL | TLS есть (HTTPS), at-rest через Supabase managed |
| GDPR compliance | 20 ч | NOT DONE | Privacy policy, data export/delete — не реализовано |
| Аудит логирование | 10 ч | PARTIAL | Credit transactions audit trail есть. Полные security logs — нет |

#### 4.4. Масштабирование и Надежность (55 ч)

| Функция | Часы по ТЗ | Статус | Примечания |
|---------|-----------|--------|------------|
| Load balancing | 18 ч | NOT DONE | Один VPS сервер |
| Кэширование | 15 ч | NOT DONE | Нет Redis/CDN caching layer |
| Queue система | 22 ч | PARTIAL | pg-boss для Telegram bot. BullMQ — нет |

#### 4.5. Аналитика и Observability (58 ч)

| Функция | Часы по ТЗ | Статус | Примечания |
|---------|-----------|--------|------------|
| Event tracking | 15 ч | NOT DONE | Posthog/Amplitude не подключен |
| Dashboards | 18 ч | PARTIAL | Admin panel с базовой статистикой (Refine) |
| A/B testing | 20 ч | NOT DONE | Feature flags не реализованы |
| AI Quality Monitoring | 5 ч | NOT DONE | Нет автоматического мониторинга качества |

**Итого по блоку:** ~112/248 часов реализовано

### БЛОК 5: Тестирование (115 ч | 345 000 руб.) — 25% готово

| Тип тестирования | Часы по ТЗ | Статус | Примечания |
|------------------|-----------|--------|------------|
| Unit тесты | 30 ч | PARTIAL | 23 test файла в backend, 3 в frontend. Coverage < 70% |
| Integration тесты | 30 ч | PARTIAL | Memory integration tests, некоторые API тесты |
| E2E тесты | 25 ч | NOT DONE | Playwright не настроен |
| Ручное тестирование | 20 ч | PARTIAL | Проводится ad-hoc |
| Нагрузочное тестирование | 10 ч | NOT DONE | k6/artillery не настроен |

**Итого по блоку:** ~29/115 часов реализовано

---

## 3. Общая сводка

| Блок | По ТЗ (ч) | Выполнено (ч) | % | Статус |
|------|-----------|---------------|---|--------|
| БЛОК 1: Core | 139 | ~124 | 89% | Почти готов |
| БЛОК 2: Essential | 219 | ~143 | 65% | В работе |
| БЛОК 3: Advanced | 110 | ~22 | 20% | Начальная стадия |
| БЛОК 4: Инфраструктура | 248 | ~112 | 45% | В работе |
| БЛОК 5: Тестирование | 115 | ~29 | 25% | Начальная стадия |
| **ИТОГО** | **831** | **~430** | **~52%** | **В работе** |

---

## 4. План завершения: что осталось сделать

### Приоритет 1: Критичные задачи (блокируют запуск)

#### P1-1. YooKassa в боевом режиме
- **Статус:** В работе (sym-157, sym-20s, sym-4mr)
- **Что сделать:**
  - [ ] Переключить YooKassa из тестового в боевой режим
  - [ ] Задеплоить `create-payment` edge function на продакшн
  - [ ] Протестировать реальные платежи на продакшне
  - [ ] Проверить фискальные чеки (54-ФЗ)
- **Оценка:** ~8 ч

#### P1-2. YooKassa интеграция для Telegram Bot
- **Статус:** Не начато
- **Что сделать:**
  - [ ] Генерация payment links из бота (YooKassa API)
  - [ ] Inline-кнопка "Купить кредиты" в боте
  - [ ] Обработка webhook с результатом оплаты
  - [ ] Начисление кредитов после успешной оплаты в боте
  - [ ] СБП доступен автоматически через YooKassa
- **Оценка:** ~25 ч

#### P1-3. Telegram Stars
- **Статус:** Не начато
- **Что сделать:**
  - [ ] Интеграция Telegram Payments API (Stars)
  - [ ] Обработка `pre_checkout_query` и `successful_payment`
  - [ ] Маппинг цен в Stars (конвертация рублей)
  - [ ] Начисление кредитов после оплаты Stars
- **Оценка:** ~17 ч

#### P1-4. Trial период
- **Статус:** Не начато
- **Что сделать:**
  - [ ] При регистрации: начисление бонусных кредитов (эквивалент 7-дневного доступа)
  - [ ] Или: 7 дней бесплатного доступа к PRO-анализу
  - [ ] Уведомление об окончании trial
  - [ ] Предложение купить кредиты после окончания trial
- **Оценка:** ~15 ч

#### P1-5. Базовый мониторинг
- **Статус:** Частично (deploy notifications)
- **Что сделать:**
  - [ ] Uptime-мониторинг (UptimeRobot или аналог) для бота и web
  - [ ] Алерты в Telegram при падении сервисов
  - [ ] Sentry для отслеживания ошибок (frontend + backend)
  - [ ] Базовые метрики в Admin-панели (DAU, платежи, ошибки)
- **Оценка:** ~15 ч

### Приоритет 2: Важные задачи (нужны для полноценного продукта)

#### P2-1. RAG-система
- **Статус:** Фундамент есть (BGE embeddings client, memory service)
- **Что сделать:**
  - [ ] Наполнение векторной БД паттернами (500+ символов кофейной гущи)
  - [ ] Embeddings pipeline для автоматической индексации новых паттернов
  - [ ] Similarity search — поиск похожих случаев при анализе
  - [ ] Feedback loop — сбор оценок пользователей (лайк/дизлайк), дообучение
- **Оценка:** ~50 ч

#### P2-2. Дневник настроения
- **Статус:** Не начато
- **Что сделать:**
  - [ ] UI: ввод настроения (шкала 1-10, выбор эмоций) в Mini App
  - [ ] Корреляция настроения с результатами анализов
  - [ ] Визуализация: графики трендов (Charts.js или Recharts)
  - [ ] Команда `/mood` в Telegram боте
- **Оценка:** ~37 ч

#### P2-3. Ежедневный AI-анализ
- **Статус:** Частично (engagement triggers)
- **Что сделать:**
  - [ ] Агрегация всех событий пользователя за день
  - [ ] AI-суммаризация: генерация дневного отчета (200-300 слов)
  - [ ] Персональные рекомендации на завтра
  - [ ] Push-уведомления с дневным инсайтом
- **Оценка:** ~30 ч

#### P2-4. GDPR / 152-ФЗ Compliance
- **Статус:** Не начато
- **Что сделать:**
  - [ ] Privacy Policy страница (RU/EN/ZH)
  - [ ] Согласие на обработку персональных данных при регистрации
  - [ ] API для экспорта данных пользователя (JSON/CSV)
  - [ ] API для удаления данных пользователя по запросу
  - [ ] Уведомление Роскомнадзора (если применимо)
- **Оценка:** ~20 ч

#### P2-5. Тестирование (средний уровень)
- **Статус:** Частично (23 backend + 3 frontend тестов)
- **Что сделать:**
  - [ ] Unit тесты на критические потоки: платежи, кредиты, авторизация
  - [ ] Integration тесты: API endpoints, webhook handlers
  - [ ] E2E тесты основных user stories (Playwright):
    - Регистрация → первый анализ → оплата → повторный анализ
    - Покупка кредитов через YooKassa
    - Просмотр истории в Mini App
  - [ ] Покрытие: целевое ~50% для критических модулей
- **Оценка:** ~45 ч

### Приоритет 3: Улучшения (повышают качество продукта)

#### P3-1. Admin-панель: расширенная аналитика
- **Статус:** Базовая панель есть (Refine)
- **Что сделать:**
  - [ ] Dashboard: DAU/MAU, конверсии, выручка по периодам
  - [ ] Управление пользователями: просмотр профиля, ручная выдача кредитов
  - [ ] Финансовые метрики: MRR, LTV, расходы на AI API
  - [ ] Управление промокодами
- **Оценка:** ~20 ч

#### P3-2. Полная документация
- **Статус:** Частично
- **Что сделать:**
  - [ ] API Reference (Swagger/OpenAPI)
  - [ ] Deployment Guide (step-by-step для VPS)
  - [ ] User Guide для заказчика
  - [ ] Описание архитектуры (актуализация docs/ARCHITECTURE.md)
- **Оценка:** ~15 ч

#### P3-3. Security hardening
- **Статус:** Частично (rate limiting есть)
- **Что сделать:**
  - [ ] CORS настройка для production
  - [ ] CSP заголовки на frontend
  - [ ] Security audit (OWASP top 10)
  - [ ] Ротация API ключей
- **Оценка:** ~10 ч

---

## 5. Что НЕ входит в текущий контракт

Следующие пункты упомянуты в оригинальном ТЗ (`coffee-reader-tz.md`) как будущие фазы, но **не входят** в оплаченный контракт на 2 275 000 руб.:

| Функционал | Приоритет в ТЗ | Фаза | Статус |
|------------|---------------|------|--------|
| WhatsApp Business интеграция | P3 | Фаза 3 (Scaling) | Не планируется |
| VK Bot | P2-P3 | Фаза 2-3 | Не планируется |
| WeChat (Mini Program + Pay) | P4 | Фаза 3+ | Не планируется |
| Instagram DM bot | P3-P4 | Фаза 3+ | Не планируется |
| Голосовые сообщения (STT/TTS) | P3 | Будущее | Не планируется |
| Video анализ (360 обзор) | P3-P4 | Будущее | Не планируется |
| AR визуализация | P4 | Будущее | Не планируется |
| Персональный психолог (WebRTC) | P4 | Будущее | Не планируется |
| Геймификация (бейджи, streak, leaderboard) | P2-P3 | Будущее | Не планируется |
| Реферальная программа | P3 | Будущее | Не планируется |
| Социальные функции (шеринг карточек) | P2 | Будущее | Не планируется |
| A/B тестирование / Feature flags | P2 | Будущее | Не планируется |
| Grafana + Prometheus (полный) | P1 | Снижен до базового | Согласовано |
| Подписочная модель (recurring billing) | P1 | Заменена на кредиты | Согласовано |

---

## 6. Текущие открытые задачи (Beads)

| ID | Приоритет | Тип | Описание | Статус |
|----|-----------|-----|----------|--------|
| sym-157 | P1 | task | Переключить YooKassa в боевой режим | open |
| sym-20s | P1 | task | Задеплоить create-payment edge function | open |
| sym-4mr | P1 | task | Тестирование платежей на продакшне | open |
| sym-9rk | P2 | epic | DeepTech Strategy: CV Pipeline для Astana Hub | open |
| sym-8kh | P2 | chore | Уточнить систему налогообложения с бухгалтером | open |

### Закрытые задачи:

| ID | Описание |
|----|----------|
| sym-dd0 | Фискальные чеки 54-ФЗ в YooKassa |
| sym-60n | PaymentResult: авто-определение статуса из БД |
| sym-m2s | Детализированные сообщения об отмене платежей |

---

## 7. Рекомендуемый порядок работ

```
Этап 1: Запуск платежей (P1-1, P1-2, P1-3)
├── YooKassa боевой режим
├── YooKassa в Telegram Bot
└── Telegram Stars

Этап 2: Retention и монетизация (P1-4, P1-5)
├── Trial период
└── Базовый мониторинг

Этап 3: Advanced функции (P2-1, P2-2, P2-3)
├── RAG-система
├── Дневник настроения
└── Ежедневный AI-анализ

Этап 4: Compliance и качество (P2-4, P2-5)
├── GDPR / 152-ФЗ
└── Тестирование

Этап 5: Финализация (P3-1, P3-2, P3-3)
├── Admin-панель расширение
├── Документация
└── Security hardening
```

### Оценка оставшегося объема

| Приоритет | Часов | Описание |
|-----------|-------|----------|
| P1 (критичные) | ~80 ч | Платежи + Trial + Мониторинг |
| P2 (важные) | ~182 ч | RAG + Дневник + Ежедневный анализ + GDPR + Тесты |
| P3 (улучшения) | ~45 ч | Админка + Документация + Security |
| **ИТОГО** | **~307 ч** | Оставшийся объем работ |

---

*Документ подготовлен: 17 февраля 2026*
*Версия: 1.0*
