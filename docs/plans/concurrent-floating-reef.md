# Ответ заказчику: Статус проекта Symancy — сопоставление с ТЗ (Extended MVP)

## Контекст

Заказчик прислал конкретный список из 5 блоков, описывающих ожидания от готового проекта. Ниже — формальная таблица статуса по каждому пункту и предложение по критериям приемки.

---

## Согласованные изменения от ТЗ

В процессе работы были приняты решения, влияющие на итоговый список:

| # | Было в ТЗ | Стало | Основание |
|---|---|---|---|
| 1 | Подписочная модель (FREE/BASIC/ADVANCED/PREMIUM) | Кредитная система (pay-per-use) | Ваше решение |
| 2 | СБП (Тинькофф) + CloudPayments + Telegram Stars | YooKassa (единый провайдер, вкл. СБП) + Telegram Stars | Согласовано |
| 3 | Мониторинг: Grafana + Prometheus + Posthog | Базовый: Uptime + Sentry + Telegram-алерты | Согласовано |
| 4 | Тестирование: >70% coverage + E2E + нагрузочные | Средний уровень: критические потоки + основные user stories | Согласовано |

---

## 1. Alpha: Core Functions (дедлайн по ТЗ: 10.11.2025)

| # | Требование | Статус | Детали |
|---|---|---|---|
| 1.1 | Onboarding < 60 сек + согласие 152-ФЗ | **Частично** | Onboarding работает. Согласие 152-ФЗ (Privacy Policy, чекбокс) — не сделано |
| 1.2 | Валидация фото: отклонять < 1080px, NSFW-фильтр | **Частично** | Прием и client-side сжатие до WebP работает. Строгая проверка разрешения и NSFW-фильтр — не сделано |
| 1.3 | AI-анализ (deepcogito/cogito-v2 через OpenRouter), 30-90 сек | **Сделано** | OpenRouter Vision API, множество моделей. Время анализа: 25-30 сек |
| 1.4 | Система лимитов (Redis-счетчики) | **Сделано** (изменено) | Кредитная система через PostgreSQL (атомарные операции). Функционально эквивалентно |
| 1.5 | Платежи: Telegram Stars | **Не сделано** | — |

---

## 2. Beta: Essential Functions (дедлайн по ТЗ: 29.12.2025)

| # | Требование | Статус | Детали |
|---|---|---|---|
| 2.1 | Telegram Mini App (TMA): история (до 12 мес), управление профилем | **Сделано** | Mini App: профиль, история с пагинацией, покупка кредитов |
| 2.2 | 3 платежные системы одновременно (СБП, CloudPayments, Telegram Stars) | **Частично** | YooKassa (Web) работает (вкл. СБП). YooKassa в боте — не сделано. Telegram Stars — не сделано |
| 2.3 | Trial: 7 дней Premium, автоактивация + автопродление | **Не сделано** | Автопродление не применимо (кредитная модель). Trial как бонусные кредиты — не реализован |
| 2.4 | Эффект "живого" общения (typing 4 сек, вариативность, "опечатки" 2%) | **Сделано** | Typing indicators, вариативность приветствий, персонализация |

Дополнительно реализовано по Блоку 2 (не в вашем списке, но из ТЗ):

| Функция | Статус |
|---|---|
| Обработка ошибок (graceful degradation, fallback модели, retry) | Сделано |
| Inline кнопки меню + выбор темы анализа | Сделано |
| Multi-language (RU, EN, ZH — 3 языка) | Сделано |
| Авторизация через Telegram (Login Widget + Custom JWT) | Сделано |
| Хранение диалогов (PostgreSQL, embeddings, memory service) | Сделано |
| Учет предыдущих гаданий (контекст в промптах) | Сделано |
| Responsive дизайн (Mobile-first, Telegram Mini App) | Сделано |

---

## 3. Advanced (конкурентные преимущества)

| # | Требование | Статус | Детали |
|---|---|---|---|
| 3.1 | RAG-система: pgvector, 500+ паттернов, similarity search, feedback loop | **Начато (~15%)** | Embeddings инфраструктура (BGE client) создана. Memory service есть. Паттерны не наполнены (0 из 500+). Similarity search не работает. Feedback loop не реализован |
| 3.2 | Дневник настроения: UI + графики корреляции | **Не сделано** | — |
| 3.3 | Ежедневная суммаризация: AI-инсайт 200-300 слов | **Не сделано** | Engagement triggers (daily/weekly напоминания) есть как фундамент |

---

## 4. Инфраструктура Production-ready

| # | Требование | Статус | Детали |
|---|---|---|---|
| 4.1 | Масштабируемость: 1000+ concurrent users, 500 анализов/час | **Не подтверждено** | 1 VPS сервер. Нет load balancing, нет Redis caching. Нагрузочное тестирование не проводилось |
| 4.2 | Безопасность: AES-256 шифрование, TLS 1.3 | **Частично** | TLS (HTTPS) есть. At-rest шифрование через Supabase managed. Дополнительное AES-256 на уровне приложения — нет |
| 4.3 | DDoS защита: Rate limiting 100 req/min | **Сделано** | Реализовано в backend (router module) |
| 4.4 | Compliance: GDPR / 152-ФЗ (экспорт/удаление данных по запросу) | **Не сделано** | Privacy Policy нет. API экспорта данных нет. API удаления данных нет |
| 4.5 | Мониторинг: дашборды + алерты в Telegram | **Частично** (согласовано снижение) | Есть: deploy-алерты в Telegram, Sentry (DSN). Нет: Grafana, Prometheus, Posthog |

Дополнительно реализовано по инфраструктуре:

| Функция | Статус |
|---|---|
| CI/CD: GitHub Actions, atomic symlink deploy, Telegram notifications | Сделано |
| YooKassa (Web): оплата через виджет, фискальные чеки 54-ФЗ | Сделано |
| Admin-панель: базовая статистика (Refine) | Сделано |
| Queue: pg-boss для Telegram bot | Сделано |
| Audit trail: все операции с кредитами логируются | Сделано |

---

## 5. Качество и тестирование

| # | Требование | Статус | Детали |
|---|---|---|---|
| 5.1 | Uptime >= 99.5% за последнюю неделю | **Не измеряется** | Нет инструмента мониторинга uptime |
| 5.2 | AI Success Rate >= 95% | **Не измеряется** | Нет автоматического мониторинга качества AI |
| 5.3 | Нет критических багов | **Выполняется** | В работающем функционале критических багов не зафиксировано |
| 5.4 | Нагрузочное тестирование | **Не сделано** | k6/artillery не настроен |

Текущее покрытие тестами: 23 test-файла backend, 3 frontend. Coverage < 70%.

---

## Сводная таблица

| Блок | Всего пунктов | Сделано | Частично | Не сделано |
|---|---|---|---|---|
| 1. Alpha (Core) | 5 | 2 | 2 | 1 |
| 2. Beta (Essential) | 4 | 2 | 1 | 1 |
| 3. Advanced | 3 | 0 | 1 | 2 |
| 4. Инфраструктура | 5 | 1 | 2 | 2 |
| 5. Качество | 4 | 1 | 0 | 3 |
| **Итого** | **21** | **6** | **6** | **9** |

---

## Оставшийся объем работ (оценка в часах)

| Приоритет | Часов | Состав |
|---|---|---|
| P1 (блокирует запуск) | ~80 ч | YooKassa боевой + бот + Telegram Stars + Trial + Мониторинг |
| P2 (полный продукт) | ~182 ч | RAG + Дневник настроения + Ежедневный анализ + GDPR + Тесты |
| P3 (улучшения) | ~45 ч | Расширение админки + Документация + Security hardening |
| **Итого** | **~307 ч** | |

---

## Предложение: критерии приемки

Для фиксации того, что считается "сданным проектом", предлагаю два варианта:

**Вариант A — Минимум для запуска (P1 задачи):**

| # | Критерий |
|---|---|
| 1 | YooKassa работает в боевом режиме (Web + Telegram Bot) |
| 2 | Telegram Stars работает |
| 3 | Trial-механика реализована (бонусные кредиты для новых пользователей) |
| 4 | Базовый мониторинг: UptimeRobot + Sentry + алерты в Telegram |
| 5 | GDPR/152-ФЗ базовый: Privacy Policy + API удаления данных |
| 6 | Нет критических багов в рабочем функционале |

**Вариант B — Полное соответствие ТЗ (P1 + P2 задачи):**

Все из Варианта A, плюс:

| # | Критерий |
|---|---|
| 7 | RAG-система: 500+ паттернов, similarity search |
| 8 | Дневник настроения: UI + графики корреляции |
| 9 | Ежедневная AI-суммаризация |
| 10 | Нагрузочное тестирование пройдено |
| 11 | E2E тесты основных user stories |

Просьба зафиксировать, какой вариант считаем приемлемым, или предложить свой список критериев.
